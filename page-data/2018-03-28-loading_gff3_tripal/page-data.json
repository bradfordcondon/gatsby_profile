{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2018-03-28-loading_gff3_tripal/","result":{"data":{"markdownRemark":{"html":"<p>I was recently tasked with using the Tripal GFF loader to add genomic coordinates to our mRNA features.  The Tripal.info tutorial <a href=\"http://tripal.info/tutorials/v3.x/example-genomic-site/genomic-data\">covers using the GFF loader</a> to load in features, but at Hardwoods we don't typically follow this paradigm, and only load in features using the FASTA loader.</p>\n<p><img src=\"/img/TripalLogo_dark.png\" alt=\"Tripal Logo\"></p>\n<h1>The GFF3 file</h1>\n<p>Before we begin, lets look at a GFF3 file.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Contig0\tFRAEX38873_v2\tgene\t16315\t44054\t.\t+\t.\tID=FRAEX38873_v2_000000010;Name=FRAEX38873_v2_000000010;biotype=protein_coding\nContig0\tFRAEX38873_v2\tmRNA\t16315\t44054\t.\t+\t.\tID=FRAEX38873_v2_000000010.1;Parent=FRAEX38873_v2_000000010;Name=FRAEX38873_v2_000000010.1;biotype=protein_coding;AED=0.05</code></pre></div>\n<p>Each entry specifies, in order, the contig the feature is located on (The <strong>Landmark</strong>: see below), the assembly version, the feature type, the start, end, and strand information of the feature.  The final column contains annotations.  Most importantly are the <strong>Name</strong> tag which the GFF file will match when looking for your feature (or use as the name when creating the new feature), and the <strong>Parent</strong> tag.  The parent <strong>must</strong> exist for the loader to continue.  </p>\n<p>In our case, we need to specify a landmark type in order for the loader to work.  If you get an error like the one specified below, then your contigs or scaffolds are not loaded, or there is a discrepency in the names in your database and in your GFF file.</p>\n<blockquote>\n<p>The landmark 'Contig0' cannot be found for this organism (Fraxinus excelsior) Please add the landmark and then retry the import of this GFF3 file</p>\n</blockquote>\n<h1>Loading the Contigs FASTA</h1>\n<p>Whatever sequence is the landmark type must be loaded prior to running the GFF importer.  The contig FASTA files are quite large, and we don't do very much with the data.  We therefore can strip the FASTA sequences from the file using sed or a custom script.  I provide an example script at the end of this file: it would be easier to use sed but I already had this program written.</p>\n<h1>Loading the GFF3 file</h1>\n<h3>Cleaning the input GFF3</h3>\n<p>If you'd like, you can clean up the GFF3 file to remove feature types you don't want inserted into your database.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"> <span class=\"token function\">awk</span> <span class=\"token string\">'{if (<span class=\"token variable\">$3</span> == \"gene\"  || <span class=\"token variable\">$3</span> == \"mrna\" ) {print}} '</span> e_walnut_filter.gff</code></pre></div>\n<p>The above command will output rows of the GFF file where the third row (the annotation type) is equal to either gene or mrna.  You can pipe the results to a new file using hte <code class=\"language-text\">&gt; output.txt</code> operator after the command.</p>\n<p> <strong>note</strong>: There can be additional problems with the input GFF file: if the loader fails, check the format of the input GFF.  For example, the below line of a GFF file failed for me because it included a <code class=\"language-text\">;</code> within a tag definition (the <code class=\"language-text\">protein 1;4</code>).</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">jcf7180001222097\tmaker\tgene\t1838197\t1841620\t.\t-\t.\tID=WALNUT_00004175;Name=WALNUT_00004175;Alias=PREDICTED: nucleosome assembly protein 1;4,Interpro:IPR002164,Pfam:PF00956;Note=high_quality_complete_model;</code></pre></div>\n<p>In this case I had to manually change these semicolons to commas.</p>\n<p>In another case, I got <code class=\"language-text\">dbxref</code> errors due to extra tags in the description: </p>\n<p><code class=\"language-text\">ID=QlobV1.0_scaffold68_0000030-RA;Parent=QlobV1.0_scaffold68_0000030;Name=QlobV1.0_scaffold68_0000030-RA;Alias=maker-scaffold68-augustus-gene-0.26-mRNA-1;Dbxref=InterPro:IPR001650,Pfam:PF00271;Note=Similar to Eukaryotic initiation factor 4A-3 (Nicotiana plumbaginifolia);_\nAED=0.08;_QI=0|0|0|1|1|1|2|0|123;_eAED=0.08;</code></p>\n<p>Since I'm pretty sure we don't need those AED, QI entries, we can remove them with sed:</p>\n<p><code class=\"language-text\">sed &#39;s/_AED.*?\\(;\\)//g&#39; Qlob.v1.0.annV1.0.gff &gt; Qlob_modified.gff</code></p>\n<p><code class=\"language-text\">sed -i &#39;s/_eAED.*?\\(;\\)//g&#39; Qlob_modified2.gff &gt;Qlob_modified3.gff</code>\n<code class=\"language-text\">sed -i &#39;s/_QI.*?\\(;\\)//g&#39; Qlob_modified3.gff &gt; Qlob_modified_final.gff</code></p>\n<p>If you've already loaded the features, don't worry, I give examples below for how to easily delete unintended features.</p>\n<h3>Renaming features in the GFF3</h3>\n<p>You might have to rename some of your features to get them loaded properly in the database.  For example, our English Walnut mRNAs had some information appended/prepended to the name.  We used this command to add it in: <code class=\"language-text\">sed ‘s/\\(WALNUT_[0-9]*-RA\\)/Juglans_regia_01182017_\\1_mRNA/g’ Reju_v4.gff</code>.</p>\n<h3>Running the GFF3 loader</h3>\n<h1>Cleaning up additional features</h1>\n<p>Tripal will insert features for <em>everything</em> in your GFF file.  This means, for example, 5' and 3' untranslated features might now be in your Chado database, even if you have no intention of using that data.  To clean up, first let's look at all the <code class=\"language-text\">type_id</code>s in our Chado database.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">SELECT DISTINCT CF.type_id, CVT.name FROM chado.feature AS CF\n\tINNER JOIN chado.cvterm AS CVT ON CVT.cvterm_id = CF.type_id;</code></pre></div>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>ID</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>exxon</td>\n<td>288</td>\n</tr>\n<tr>\n<td>contig</td>\n<td>105</td>\n</tr>\n<tr>\n<td>mRNA</td>\n<td>145</td>\n</tr>\n<tr>\n<td>gene</td>\n<td>215</td>\n</tr>\n<tr>\n<td>polypeptide</td>\n<td>236</td>\n</tr>\n<tr>\n<td>CDS</td>\n<td>237</td>\n</tr>\n<tr>\n<td>exon</td>\n<td>288</td>\n</tr>\n<tr>\n<td>supercontig</td>\n<td>290</td>\n</tr>\n<tr>\n<td>five<em>prime</em>UTR</td>\n<td>354</td>\n</tr>\n<tr>\n<td>three<em>prime</em>UTR</td>\n<td>355</td>\n</tr>\n<tr>\n<td>mRNA_contig</td>\n<td>101394</td>\n</tr>\n</tbody>\n</table>\n<p>In my case, the UTRs, exons, and CDS are all unnecessary: let's remove them.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">SET search_path TO chado, public;\nDELETE FROM chado.feature WHERE type_id IN (355, 354, 237, 288);</code></pre></div>\n<p>We need to set the search path to include prior to deleting: otherwise the command will fail.</p>\n<p>If you make mistakes in your featureloc table, deleting them can be a bit tricky too.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">DELETE FROM chado.featureloc FL WHERE FL.feature_id IN (SELECT feature_id FROM chado.feature where organism_id IN (42, 24, 48));</code></pre></div>\n<p>Here I delete things from the featureloc table that match my organisms with errors.</p>\n<h1>Perl script for removing sequences from FASTA</h1>\n<div class=\"gatsby-highlight\" data-language=\"perl\"><pre class=\"language-perl\"><code class=\"language-perl\"><span class=\"token comment\">#!/usr/bin/env perl</span>\n<span class=\"token comment\">#simple Bioperl script to remove seqs from FASTA file.</span>\n\n<span class=\"token keyword\">use</span> strict<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> warnings<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> Getopt<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Long<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> Bio<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>SeqIO<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> Data<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Dumper<span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># usage</span>\n<span class=\"token keyword\">my</span> <span class=\"token variable\">$usage</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"$0 -i|input fasta_input_files \\n\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># global values</span>\n<span class=\"token keyword\">my</span> <span class=\"token variable\">$input_file</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># read user options</span>\nGetOptions<span class=\"token punctuation\">(</span>\n\t<span class=\"token string\">\"i|input=s\"</span> <span class=\"token operator\">=></span> <span class=\"token operator\">\\</span><span class=\"token variable\">$input_file</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># check for user parameters</span>\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span><span class=\"token variable\">$input_file</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">die</span> <span class=\"token variable\">$usage</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># open input fasta file</span>\n<span class=\"token keyword\">unless</span><span class=\"token punctuation\">(</span> <span class=\"token operator\">-e</span> <span class=\"token variable\">$input_file</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">die</span> <span class=\"token string\">\"error: cannot find fasta input file $input_file\\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">my</span> <span class=\"token variable\">$input</span> <span class=\"token operator\">=</span> Bio<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>SeqIO<span class=\"token operator\">-></span>new <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span>file <span class=\"token operator\">=></span> <span class=\"token string\">\"&lt;$input_file\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'-format'</span> <span class=\"token operator\">=></span> <span class=\"token string\">'Fasta'</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token operator\">or</span> <span class=\"token keyword\">die</span> <span class=\"token string\">\"error: failure opening fasta $input_file for reading: $!\\n\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># make temporary fasta file and print header line</span>\n<span class=\"token keyword\">my</span> <span class=\"token variable\">$output_file</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"$input_file.empty.fasta\"</span><span class=\"token punctuation\">;</span>\nopen<span class=\"token punctuation\">(</span> OUT<span class=\"token punctuation\">,</span> <span class=\"token string\">\">$output_file\"</span> <span class=\"token punctuation\">)</span>\n\t<span class=\"token operator\">or</span> <span class=\"token keyword\">die</span> <span class=\"token string\">\"error: cannot open $output_file for writing: $!\\n\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># step through sequences in input fasta file</span>\n<span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">my</span> <span class=\"token variable\">$seqObject</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$input</span><span class=\"token operator\">-></span>next_seq <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\n\t<span class=\"token comment\"># get sequence information</span>\n\t<span class=\"token keyword\">my</span> <span class=\"token variable\">$id</span>  <span class=\"token operator\">=</span> <span class=\"token variable\">$seqObject</span><span class=\"token operator\">-></span>id<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">my</span> <span class=\"token variable\">$seq</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$seqObject</span><span class=\"token operator\">-></span>seq<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">print</span> <span class=\"token string\">\"extracting $id\\n\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">print</span> OUT <span class=\"token string\">\">$id\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">;</span>  \t\n\t\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"Tripal GFF Loader"}}},"pageContext":{"slug":"/2018-03-28-loading_gff3_tripal/"}},"staticQueryHashes":["2744294623","3649515864"]}
{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2017-12-22-plotting_with_d3/","result":{"data":{"markdownRemark":{"html":"<p><img src=\"/img/d3/d3_logo.png\" alt=\"D3 logo\"></p>\n<p><a href=\"https://d3js.org/\">D3js (Data-Driven Documents)</a> is a Javascript library that manipulates the DOM and is often used to build SVG plots.  I recently created an interactive plot for differential expression data as part of the <a href=\"https://github.com/tripal/tripal_analysis_expression/\">Tripal Analysis Expression module</a>. Because other Tripal modules use D3 v3.x, I was required to do the same (as opposed to v4, the latest version).  While the <a href=\"https://github.com/d3/d3-3.x-api-reference/blob/master/API-Reference.md\">API is available</a>, I'm the sort of person who learns best from tutorials and examples, and I struggled to find enough v3 examples.</p>\n<blockquote>\n<p><img src=\"/img/d3/taexp_plot.png\" alt=\"Tripal Analysis Expression plot\"></p>\n<p>The Tripal Analysis Expression module groups and colors data based on user selection. Each group can be dragged and rearranged.  By the end of this series, you'll be able to create higher order plots like this in D3.</p>\n</blockquote>\n<p>With that in mind, I am writing this basic D3js v3 tutorial. This is installment one, where we create a very basic and unimpressive plot using just <code class=\"language-text\">data()</code> and <code class=\"language-text\">enter()</code>.  I recommend some starting resources below, but this tutorial is aimed at beginners.</p>\n<p>The code for this lesson is available as a <a href=\"https://gist.github.com/bradfordcondon/317fe6b4edd66ba3904ed2248f8b6134\">GitHub gist</a>, or visualized with <a href=\"https://bl.ocks.org/bradfordcondon/317fe6b4edd66ba3904ed2248f8b6134\">Bl.ocks</a>.</p>\n<h3>Background reading</h3>\n<p>Before we get started, you should understand the basics of</p>\n<ul>\n<li><a href=\"https://www.javascript.com/\">Javascript</a></li>\n<li><a href=\"https://jquery.com/\">jQuery</a></li>\n<li>The <a href=\"https://www.w3schools.com/js/js_htmldom.asp\">DOM model</a></li>\n<li><a href=\"https://www.w3schools.com/graphics/svg_intro.asp\">SVG</a></li>\n<li>A browser developer console such as <a href=\"https://developer.chrome.com/devtools\">Google Chrome</a></li>\n</ul>\n<p>I'd also recommend looking over the <a href=\"https://d3js.org/\">D3 website</a> and reading the introduction/gaining inspiration from the plots.</p>\n<h3>Why D3?</h3>\n<p>There are other plotting solutions for javascript.  I like D3 because it strikes a nice balance between ease of use and flexibility.  It might be easier to get results plotting something with, for example, <a href=\"https://plot.ly/javascript/\">plot.ly</a> (which is built on top of D3), but the higher layer of abstraction leaves you with fewer options.</p>\n<h2>D3: the basics</h2>\n<p>I recommended reading about jQuery in the introduction because they share the same fundamental goal: select objects in the DOM and manipulate them.  jQuery is much broader in scope: it's a general purpose javascript library.  D3's twist is revealed in it's name: Data-Driven Documents.  The assumption is that you've got data (represented in an array) and you want to <em>apply</em> that data to the DOM.  Typically, that means visualize it in some way!</p>\n<h3>Show me the data</h3>\n<p>How does D3 communicate your data to the DOM?  Using the <code class=\"language-text\">data()</code>, <code class=\"language-text\">enter()</code> methods!</p>\n<p>Let's make a simple example.  You can follow along by pasting the code into text editor and opening the file in a web browser.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token constant\">DOCTYPE</span> html<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>style<span class=\"token operator\">></span>\n<span class=\"token punctuation\">.</span>axis <span class=\"token punctuation\">.</span>domain <span class=\"token punctuation\">{</span>\n  display<span class=\"token operator\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>style<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>svg width<span class=\"token operator\">=</span><span class=\"token string\">\"960\"</span> height<span class=\"token operator\">=</span><span class=\"token string\">\"500\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>svg<span class=\"token operator\">></span> \n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"https://d3js.org/d3.v3.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n  \n<span class=\"token keyword\">var</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>name<span class=\"token operator\">:</span> <span class=\"token string\">\"one\"</span><span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n             <span class=\"token punctuation\">{</span>name<span class=\"token operator\">:</span> <span class=\"token string\">\"two\"</span><span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> <span class=\"token string\">\"a\"</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n              <span class=\"token punctuation\">{</span>name<span class=\"token operator\">:</span> <span class=\"token string\">\"two\"</span><span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> <span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n             <span class=\"token punctuation\">{</span>name<span class=\"token operator\">:</span> <span class=\"token string\">\"four\"</span><span class=\"token punctuation\">,</span> property<span class=\"token operator\">:</span> <span class=\"token string\">\"b\"</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token number\">57</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token keyword\">var</span> svg <span class=\"token operator\">=</span> d3<span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"svg\"</span><span class=\"token punctuation\">)</span> \n    \n <span class=\"token keyword\">var</span> bars<span class=\"token operator\">=</span>  svg<span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.bar'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">enter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'g'</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'transform'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">'translate('</span> <span class=\"token operator\">+</span> i<span class=\"token operator\">*</span> <span class=\"token number\">20</span> <span class=\"token operator\">+</span> <span class=\"token string\">',0)'</span><span class=\"token punctuation\">;</span> \n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rect'</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fill'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"height\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> d<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n <span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'width'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n  \n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n  </code></pre></div>\n<p>Below is the resulting plot.</p>\n<div id=\"output_plot\"></div>\n<p>There's a couple of problems here, but let's see what we are trying to do.</p>\n<ul>\n<li>We define a data array consisting of objects with some simple key => value pairs.  For now we just use the <code class=\"language-text\">name</code> and <code class=\"language-text\">value</code> property.</li>\n<li>We define and select the <code class=\"language-text\">svg</code> element which holds our graphics.</li>\n<li>We enter our data into the <code class=\"language-text\">svg</code> using the <code class=\"language-text\">data()</code> and <code class=\"language-text\">enter()</code> calls.</li>\n<li>We append <code class=\"language-text\">g</code> elements to each <code class=\"language-text\">.bar</code> object.</li>\n<li>We transform each <code class=\"language-text\">g</code> object by translating it, shifting it along the x-axis.</li>\n<li>We append a <code class=\"language-text\">rect</code> element.</li>\n<li>We transform the  <code class=\"language-text\">rect</code> element based on the data.</li>\n</ul>\n<p>Pay special attention to <code class=\"language-text\">function (d, i) {//code}</code>.  Because we've entered our data, we can define a function that takes the <em><code class=\"language-text\">i</code>th</em> element of the <code class=\"language-text\">data</code> array as <code class=\"language-text\">d</code> as an input, and outputs what we want.</p>\n<h3>Chaining</h3>\n<p>D3 allows for <em>chaining</em> method calls together, much like jQuery.  In the above example, we took advantage of chaining several times.  For example...</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token keyword\">var</span> bars<span class=\"token operator\">=</span>  svg<span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.bar'</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">enter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'g'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>What's important to understand is that the chain is executed in order, and each link in the chain passes down its selection to the next member.  This means that subsequent calls after <code class=\"language-text\">.append(&#39;g&#39;)</code> will <em>affect that g element</em>.  On the other hand, setting the <code class=\"language-text\">style</code> or <code class=\"language-text\">attr</code> of an element will pass on the reference element, meaning you can execute several <code class=\"language-text\">style</code> calls in a row on the same element (as we do above)</p>\n<p>If chaining confuses you, the above code could be written without chaining, as</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token keyword\">var</span> bars<span class=\"token operator\">=</span>  svg<span class=\"token punctuation\">.</span><span class=\"token function\">selectAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.bar'</span><span class=\"token punctuation\">)</span>\n bars<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n bars<span class=\"token punctuation\">.</span><span class=\"token function\">enter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n bars<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">'g'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Entering data with  <code class=\"language-text\">.selectAll().data().enter().append()</code></h3>\n<p>This chain will look very familiar to you the more you use D3.  The <code class=\"language-text\">data</code> method requires a selection to bind data to.  It might be confusing that we select all <code class=\"language-text\">.bar</code> elements in the above example: what <code class=\"language-text\">.bar</code>?  They <strong>dont exist yet!</strong></p>\n<p>That's where <code class=\"language-text\">.enter()</code> comes in.  It compares the data in <code class=\"language-text\">data()</code> and the selection, and creates new placeholder elements for the entered data.</p>\n<h3>Looping through data</h3>\n<p>You may be confused how each element gets \"told\" what its height and x-position should be.  The answer lies in how D3 has created an element for each element in our data array.</p>\n<p>Consider how we style the height in the above code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">.</span><span class=\"token function\">style</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"height\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">d<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n <span class=\"token keyword\">return</span> d<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Rather than returning a fixed height, we use a <strong>function</strong> to dynamically return the height based on <code class=\"language-text\">d</code> and <code class=\"language-text\">i</code>.  <code class=\"language-text\">d</code> is the individual data entry, and <code class=\"language-text\">i</code> is its key.  In our example code, when <code class=\"language-text\">i = 2</code>, <code class=\"language-text\">d = {name: &quot;two&quot;, property: &quot;a&quot;, value: 50}</code>.</p>\n<p>Because our data structure has a <code class=\"language-text\">value</code> key, simply returning <code class=\"language-text\">d.value</code> will set the height of the bar based on the value of that element!  If you are getting confused, I recommend including a <code class=\"language-text\">console.log(d)</code> in your function.  You'll see in your console that each data object in the array is returned one by one.</p>\n<h2>Building a better plot</h2>\n<p>This is clearly not an award winning plot.  We have no axes, scaling, grouping, labels, legends, or titles.  The colors are uniform.  Oh, and it's upside down (a surprisingly persistent problem with D3!)</p>\n<p>We'll cover the rest in later lessons.  But for now, try to define your own dataset and bind it to the DOM using <code class=\"language-text\">data()</code> and <code class=\"language-text\">enter()</code>.</p>\n<p>Continue reading with <a href=\"/2017/12/31/d3_part2_flipping/\">part two: implementing scales</a>.</p>\n<p>Did you enjoy this article?  Looking for more information?  Please feel free to contact me on twitter @bradfordcondon</p>","frontmatter":{"title":"Plotting with D3 part 1"}}},"pageContext":{"slug":"/2017-12-22-plotting_with_d3/"}},"staticQueryHashes":["2744294623","3649515864"],"slicesMap":{}}